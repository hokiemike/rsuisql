select
	s.SUB_POLICY_NUMBER,
	s.SUB_POLICY_SUFFIX,
	q.SUB_RECORD_NUMBER,
	q.QB_GROSS_PREMIUM,
	sum(l.LAYER_PREMIUM) AS [SumOfLayers],
	count(l.LAYER_PREMIUM) AS [CountOfLayers],
	(q.QB_GROSS_PREMIUM - sum(l.LAYER_PREMIUM)) AS [Difference]
from
	QUOTE_BINDER q
		inner join SUBMISSION s on 
			q.SUB_RECORD_NUMBER = s.SUB_RECORD_NUMBER and q.QB_SEQUENCE_NO = s.QB_SEQUENCE_NO
		inner join RI_HEADER_LEVEL h on 
			q.SUB_RECORD_NUMBER = h.SUB_RECORD_NUMBER and q.QB_SEQUENCE_NO = h.QB_SEQUENCE_NO
		left outer join RI_LAYER_LEVEL l on
			h.HEADER_LEVEL_SKEY = l.HEADER_LEVEL_SKEY
WHERE
	s.SUB_RECORD_NUMBER not in --there is one quote that has a spreader that could not be converted properly
--and 176 bound quotes that have no terrorism (ie not converted) and have the sum of their layers not totaling the gross premium
(512781,55453,19903,132655,155367,21562,116363,35752,114051,67369,95244,73155,82824,111307,23332,20483,71091,22633,
141435,21030,29434,22113,21858,20820,18159,29337,22493,23013,20687,19311,22185,83318,371631,21210,23317,77834,1460,
64671,383499,20368,22917,22120,139865,20740,25906,46407,40563,165632,360385,18866,21161,329256,20277,21274,37045,
207043,386455,66370,23586,22339,79979,20672,18478,22343,37015,24118,24586,79657,74719,25304,4705,22066,145219,74584,
68751,27204,25292,23420,136730,19224,21308,360266,355090,18865,22943,24935,23397,27448,142187,25236,360606,99023,
377360,360505,20318,131232,79256,69365,66302,47341,30140,21289,134005,24199,19779,61894,22084,25214,371225,20589,
24630,37145,73159,18505,5086,98415,24783,73241,427552,24697,21547,7468,95269,30748,21822,21886,73182,23314,404767,46556,
132186,74827,5277,23577,23931,371118,402777,23376,5311,78619,24390,71468,350973,55528,136696,89648,67334,316067,120787,23026,
67654,73206,55529,18966,26464,22929,371545,76880,141432,18256,396065,5881,20868,81980,393450,360392,90046,420044,38439,
77274,23087,21130,380596,18770,22090,22678,386466) and
	h.ENDORSEMENT_SKEY is null AND h.CLAIM_SKEY is null
GROUP BY
	s.SUB_POLICY_NUMBER,
	s.SUB_POLICY_SUFFIX,
	q.SUB_RECORD_NUMBER,
	q.QB_GROSS_PREMIUM
HAVING
	q.QB_GROSS_PREMIUM != sum(l.LAYER_PREMIUM)